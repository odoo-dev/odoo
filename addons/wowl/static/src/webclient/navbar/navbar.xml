<?xml version="1.0" encoding="UTF-8" ?>
<templates xml:space="preserve">

  <header t-name="wowl.NavBar" owl="1">
    <nav class="o_main_navbar" t-on-dropdown-item-selected="onNavBarDropdownItemSelection">
      <!-- Apps Menu -->
      <t t-call="wowl.NavBar.AppsMenu">
        <t t-set="apps" t-value="menuService.getApps()" />
      </t>

      <!-- App Brand -->
      <DropdownItem
        t-if="currentApp"
        class="o_menu_brand"
        payload="currentApp"
        t-esc="currentApp.name" />

      <!-- Current App Sections -->
      <t t-call="wowl.NavBar.SectionsMenu">
        <t t-set="sections" t-value="currentAppSections" />
      </t>

      <!-- Systray -->
      <ul class="o_menu_systray" role="menu">
        <t t-foreach="systrayItems" t-as="item" t-key="item.name">
          <t t-component="item.Component" />
        </t>
      </ul>
    </nav>
  </header>

  <Dropdown t-name="wowl.NavBar.AppsMenu" hotkey="'h'" class="o_navbar_apps_menu" owl="1">
    <i class="fa fa-th-large" />
    <t t-set-slot="menu">
      <DropdownItem
        t-foreach="apps" t-as="app" t-key="app.id" 
        t-att-class="{ o_dropdown_active: menuService.getCurrentApp() === app }"
        payload="app"
        t-esc="app.name" />
    </t>
  </Dropdown>

  <ul t-name="wowl.NavBar.SectionsMenu" class="o_menu_sections" role="menu" owl="1">
    <t
      t-foreach="sections"
      t-as="section"
      t-key="section.id">

      <t t-set="sectionsVisibleCount" t-value="(sections.length - currentAppSectionsExtra.length)" />

      <t t-if="section_index lt Math.min(10, sectionsVisibleCount)">
        <t t-set="hotkey" t-value="((section_index + 1) % 10).toString()"/>
      </t>
      <t t-else="">
        <t t-set="hotkey" t-value="undefined"/>
      </t>

      <DropdownItem t-if="!section.childrenTree.length" payload="section" hotkey="hotkey">
        <span t-esc="section.name" t-att-data-section="section.id" />
      </DropdownItem>

      <t t-else="" t-call="wowl.NavBar.SectionsMenu.Dropdown">
        <t t-set="sectionId" t-value="section.id" />
        <t t-set="name" t-value="section.name" />
        <t t-set="items" t-value="section.childrenTree" />
        <t t-set="hotkey" t-value="hotkey"/>
      </t>

    </t>

    <t t-call="wowl.NavBar.SectionsMenu.MoreDropdown">
      <t t-set="sections" t-value="currentAppSectionsExtra" />
      <t t-if="sectionsVisibleCount lt 10">
        <t t-set="hotkey" t-value="(sectionsVisibleCount + 1 % 10).toString()"/>
      </t>
    </t>

  </ul>

  <Dropdown t-name="wowl.NavBar.SectionsMenu.Dropdown" hotkey="hotkey" owl="1" >
    <span t-esc="name" t-att-data-section="sectionId" />
    <t t-set-slot="menu">
      <t t-call="wowl.NavBar.SectionsMenu.Dropdown.MenuSlot">
        <t t-set="items" t-value="items" />
      </t>
    </t>
  </Dropdown>

  <t t-name="wowl.NavBar.SectionsMenu.Dropdown.MenuSlot" owl="1">
    <t t-foreach="items" t-as="item" t-key="item.id">
      <DropdownItem t-if="!item.childrenTree.length" payload="item" t-esc="item.name" />

      <t t-else="">
        <div class="o_dropdown_menu_group" t-esc="item.name" />
        <DropdownItem
          t-foreach="item.childrenTree"
          t-as="subItem"
          t-key="subItem.id"
          class="o_dropdown_menu_group_entry"
          payload="subItem"
          t-esc="subItem.name" />
      </t>
    </t>
  </t>

  <Dropdown t-name="wowl.NavBar.SectionsMenu.MoreDropdown" class="o_menu_sections_more d-none" hotkey="hotkey" owl="1">
    <i class="fa fa-plus" />
    <t t-set-slot="menu">
      <t
        t-foreach="sections"
        t-as="section"
        t-key="section.id">

        <DropdownItem
          t-if="!section.childrenTree.length"
          class="o_more_dropdown_section"
          payload="section"
          t-esc="section.name" />

        <t t-else="">
          <div
            class="o_more_dropdown_section o_more_dropdown_section_group"
            t-esc="section.name" />
          <t t-call="wowl.NavBar.SectionsMenu.Dropdown.MenuSlot">
            <t t-set="items" t-value="section.childrenTree" />
          </t>
        </t>

      </t>
    </t>
  </Dropdown>

</templates>
