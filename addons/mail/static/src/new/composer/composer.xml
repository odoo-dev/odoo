<?xml version="1.0" encoding="UTF-8" ?>
<templates xml:space="preserve">

<t t-name="mail.composer" owl="1">
    <t t-set="compact" t-value="props.mode === 'compact'"/>
    <t t-set="normal" t-value="props.mode === 'normal'"/>
    <t t-set="extended" t-value="props.mode === 'extended'"/>
    <div class="o-mail-composer-container" t-ref="composer">
        <div class="o-mail-composer d-grid flex-shrink-0"
                t-att-class="{
                    'px-3 py-2 o-mail-extended-composer': extended,
                    'p-3': normal,
                    'o-has-current-partner-avatar px-3': !this.env.inChatWindow and thread,
                }">
            <div class="o-mail-composer-sidebar-main flex-shrink-0" t-if="!compact">
                <img class="o-mail-composer-avatar mt-1 rounded-circle" t-att-src="store.self.avatarUrl" alt="Avatar of user"/>
            </div>
            <div class="o-mail-composer-core-header text-truncate small p-2" t-if="props.composer.thread and props.messageToReplyTo?.thread === props.composer.thread">
                <span class="cursor-pointer" t-on-click="() => props.highlightReplyTo and props.highlightReplyTo(props.messageToReplyTo.message.id)">
                    Replying to <b t-esc="props.messageToReplyTo.message.author.name"/>
                </span>
                <span t-if="props.messageToReplyTo.message.originThread !== thread" class="o-mail-composer-origin-thread">
                    on: <b><t t-esc="props.messageToReplyTo.message.originThread.displayName"/></b>
                </span>
                <i class="fa fa-lg fa-times-circle rounded-circle p-0 ms-1 cursor-pointer" title="Stop replying" t-on-click="() => props.messageToReplyTo.cancel()"/>
            </div>
            <div class="o-mail-composer-core-main d-flex flex-nowrap align-items-start flex-grow-1"
                t-att-class="{ 'flex-column' : extended }"
            >
                <div class="d-flex border bg-view flex-grow-1"
                    t-att-class="{
                        'border-end-0 rounded-start-3' : normal,
                        'rounded-3 align-self-stretch flex-column' : extended,
                    }"
                >
                    <div class="position-relative flex-grow-1">
                        <textarea class="o-mail-composer-textarea form-control bg-view px-3 border-0 rounded-3 shadow-none overflow-auto"
                            t-ref="textarea"
                            style="height:40px;"
                            t-on-keydown="onKeydown"
                            t-on-input="onInput"
                            t-on-focusin="onFocusin"
                            t-on-focusout="() => this.props.composer.isFocused = false"
                            t-on-paste="onPaste"
                            t-model="props.composer.textInputContent"
                            t-att-placeholder="placeholder"/>
                    </div>
                    <div class="d-flex mx-3 bg-view"
                        t-att-class="{
                            'px-1' : normal,
                            'border-top p-1' : extended,
                        }"
                    >
                        <div class="d-flex flex-grow-1 align-items-center" >
                            <button class="btn btn-light border-0 fa fa-smile-o rounded-pill" aria-label="Emojis" t-on-click="onClickAddEmoji" t-ref="emoji-picker"/>
                            <FileUploader multiUpload="true" onUploaded="(data) => attachmentUploader.uploadData(data)">
                                <t t-set-slot="toggler">
                                    <button t-att-disabled="!state.active" class="btn btn-light fa fa-paperclip border-0 rounded-pill" title="Attach files" aria-label="Attach files" type="button" t-on-click="onClickAddAttachment"/>
                                </t>
                            </FileUploader>
                        </div>
                        <button t-if="thread and thread.type === 'chatter'" class="btn btn-light fa fa-expand mx-1 border-0 rounded-pill" title="Full composer" aria-label="Full composer" type="button" t-on-click="onClickFullComposer"/>
                    </div>
                </div>

                <t t-if="!compact" t-call="mail.Composer.actionButtons"/>
            </div>
            <div class="o-mail-composer-footer overflow-auto">
                <AttachmentList
                    t-if="attachmentUploader.attachments.length > 0"
                    attachments="attachmentUploader.attachments"
                    unlinkAttachment="attachmentUploader.unlink"
                    editable="true"
                    imagesHeight="50" />
                <div t-if="thread and thread.type !== 'chatter' and !compact" class="o-mail-composer-is-typing">
                    <Typing channel="thread" size="'medium'" />
                </div>
            </div>
        </div>
        <span t-if="props.composer.message" class="text-muted">escape to <a href="#" t-on-click="props.onDiscardCallback">cancel</a>, enter to <a href="#" t-on-click="editMessage">save</a></span>
    </div>
</t>

    <t t-name="mail.Composer.suggestionPartner" owl="1">
        <t t-set="partner" t-value="option.partner"/>
        <PartnerImStatus t-if="option.partner" partner="partner"/>
        <strong class="px-2 py-1 align-self-center flex-shrink-0 text-truncate">
            <t t-esc="partner.name" />
        </strong>
        <em t-if="partner.email" class="text-600 text-truncate align-self-center">(<t t-esc="partner.email" />)</em>
    </t>

    <t t-name="mail.Composer.suggestionThread" owl="1">
        <strong class="px-2 py-1 align-self-center flex-shrink-0 text-truncate">
            #<t t-esc="option.label" />
        </strong>
    </t>

    <t t-name="mail.Composer.suggestionChannelCommand" owl="1">
        <strong class="px-2 py-1 align-self-center flex-shrink-0 text-truncate">
            <t t-esc="option.label" />
        </strong>
        <em class="text-600 text-truncate align-self-center">
            <t t-esc="option.help"/>
        </em>
    </t>

    <t t-name="mail.Composer.suggestionCannedResponse" owl="1">
        <strong class="px-2 py-1 align-self-center flex-shrink-0 text-truncate">
            <t t-esc="option.name" />
        </strong>
        <em class="text-600 text-truncate align-self-center">
            <t t-esc="option.label"/>
        </em>
    </t>

    <t t-name="mail.Composer.actionButtons" owl="1">
        <div class="d-flex"
            t-att-class="{
                'border-end border-start border-bottom': compact,
                'rounded-end-3 bg-view align-self-stretch' : normal,
                'flex-column' : extended,
            }"
        >
            <button class="o-mail-composer-send-button btn btn-primary o-last border-start-0"
                t-att-class="{'mt-2': extended, 'rounded-0 rounded-end-3': !extended}"
                t-on-click="sendMessage"
                type="button"
                data-action="send"
                t-att-disabled="isSendButtonDisabled"
            >
                Send
            </button>
        </div>
    </t>



</templates>
