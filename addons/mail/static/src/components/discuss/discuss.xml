<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">

    <t t-name="mail.Discuss" owl="1">
        <div class="o_Discuss"
            t-att-class="{
                'o-adding-item': discuss ? discuss.isAddingChannel or discuss.isAddingChat : false,
                'o-mobile': env.messaging ? env.messaging.device.isMobile : false,
            }"
        >
            <t t-if="!env.isMessagingInitialized()">
                <div class="o_Discuss_messagingNotInitialized"><i class="o_Discuss_messagingNotInitializedIcon fa fa-circle-o-notch fa-spin"/>Please wait...</div>
            </t>
            <t t-else="">
                <t t-if="!env.messaging.device.isMobile">
                    <DiscussSidebar class="o_Discuss_sidebar"/>
                </t>
                <t t-if="env.messaging.device.isMobile" t-call="mail.Discuss.content"/>
                <t t-else="">
                    <div class="o_Discuss_content">
                        <t t-call="mail.Discuss.content"/>
                    </div>
                </t>
            </t>
        </div>
    </t>

    <t t-name="mail.Discuss.content" owl="1">
        <t t-if="env.messaging.device.isMobile and discuss.activeMobileNavbarTabId === 'mailbox'">
            <DiscussMobileMailboxSelection class="o_Discuss_mobileMailboxSelection"/>
        </t>
        <t t-if="env.messaging.device.isMobile and (discuss.isAddingChannel or discuss.isAddingChat)">
            <div class="o_Discuss_mobileAddItemHeader">
                <AutocompleteInput
                    class="o_Discuss_mobileAddItemHeaderInput"
                    isFocusOnMount="true"
                    isHtml="discuss.isAddingChannel"
                    placeholder="discuss.isAddingChannel ? addChannelInputPlaceholder : addChatInputPlaceholder"
                    select="_onMobileAddItemHeaderInputSelect"
                    source="_onMobileAddItemHeaderInputSource"
                    t-on-o-hide="_onHideMobileAddItemHeader"
                />
            </div>
        </t>
        <div class="o_Discuss_topbar">
            <div class="o_Discuss_topbarTitle">
                <t t-if="discuss.thread">
                    <ThreadIcon class="o_Discuss_topbarThreadIcon" threadLocalId="discuss.thread.localId"/>
                    <div class="o_Discuss_topbarThreadName" t-att-title="discuss.thread.displayName">
                        <t t-esc="discuss.thread.displayName"/>
                    </div>
                </t>
                <t t-if="!discuss.thread">
                    <div class="o_Discuss_topbarThreadName" title="Discuss">
                        Discuss
                    </div>
                </t>
                <t t-if="discuss.thread and discuss.thread.description">
                    <div class="o_Discuss_topbarThreadDescriptionSeparator"/>
                    <div class="o_Discuss_topbarThreadDescription" t-att-title="discuss.thread.description">
                        <t t-esc="discuss.thread.description"/>
                    </div>
                </t>
            </div>
            <div class="o_Discuss_topbarActions">
                <t t-if="discuss.thread and discuss.thread.model === 'mail.channel'">
                    <Popover popoverExtraClass="'o_Discuss_invitePopover'" position="'bottom'">
                        <button class="o_Discuss_InviteButton btn btn-secondary">
                            <i class="fa fa-user-plus"/>
                        </button>
                        <t t-set="opened">
                            <PartnerSelector
                                invitePartnerListLocalId="discuss.thread.invitePartnerList.localId"
                            />
                        </t>
                    </Popover>
                    <Popover popoverExtraClass="'o_Discuss_memberListPopover'" position="'bottom'">
                        <button class="o_Discuss_InviteButton btn btn-secondary">
                            <i class="fa fa-chevron-circle-down"/>
                        </button>
                        <t t-set="opened">
                            <PartnerListing
                                members="discuss.thread.members"
                                threadLocalId="discuss.thread.localId"
                            />
                        </t>
                    </Popover>
                </t>
                <t t-if="discuss.thread and discuss.threadView and discuss.thread === env.messaging.inbox">
                    <button class="o_Discuss_markAllReadButton btn btn-secondary" t-att-disabled="discuss.threadView.messages.length === 0" t-on-click="_onClickMarkAllAsRead">Mark all read</button>
                </t>
                <t t-if="discuss.thread and discuss.threadView and discuss.thread === env.messaging.starred">
                    <button class="o_Discuss_unstarAllButton btn btn-secondary" t-att-disabled="discuss.threadView.messages.length === 0" t-on-click="_onClickUnstarAll">Unstar all</button>
                </t>
                <t t-if="discuss.thread and discuss.thread.model === 'mail.channel'">
                    <RtcController threadLocalId="discuss.thread.localId" showMembersButton="true"/>
                </t>
                <t t-if="env.messaging.device.isMobile">
                    <t t-if="discuss.activeMobileNavbarTabId === 'chat'">
                        <button class="o_Discuss_mobileNewMessageButton btn btn-secondary" t-on-click="_onClickMobileNewMessageButton">New Message</button>
                    </t>
                    <t t-if="discuss.activeMobileNavbarTabId === 'channel'">
                        <button class="o_Discuss_mobileNewChannelButton btn btn-secondary" t-on-click="_onClickMobileNewChannelButton">New Channel</button>
                    </t>
                </t>
            </div>
        </div>
        <div class="o_Discuss_topbarBottomSeparator"/>
        <t t-if="discuss.threadView">
            <div class="o_Discuss_thread_container">
                <ThreadView
                    class="o_Discuss_thread"
                    t-att-class="{ 'o-mobile': env.messaging.device.isMobile }"
                    composerAttachmentsDetailsMode="'card'"
                    hasComposer="discuss.thread.model !== 'mail.box'"
                    hasComposerCurrentPartnerAvatar="!env.messaging.device.isMobile"
                    hasComposerThreadTyping="true"
                    hasMessageCheckbox="true"
                    hasSquashCloseMessages="discuss.thread.model !== 'mail.box'"
                    haveMessagesMarkAsReadIcon="discuss.thread === env.messaging.inbox"
                    haveMessagesReplyIcon="discuss.thread === env.messaging.inbox"
                    isDoFocus="discuss.isDoFocus"
                    threadViewLocalId="discuss.threadView.localId"
                    t-on-o-focusin-composer="_onFocusinComposer"
                    t-on-o-rendered="_onThreadRendered"
                    t-ref="threadView"
                />
                <t t-if="env.messaging.showMemberList and discuss.thread and ['channel', 'chat', 'group'].includes(discuss.thread.channel_type)">
                    <RtcCallParticipants class="o_Discuss_thread_callParticipants" threadLocalId="discuss.thread.localId"/>
                </t>
            </div>
        </t>
        <t t-if="!discuss.thread and (!env.messaging.device.isMobile or discuss.activeMobileNavbarTabId === 'mailbox')">
            <div class="o_Discuss_noThread">
                No conversation selected.
            </div>
        </t>
        <t t-if="env.messaging.device.isMobile and discuss.activeMobileNavbarTabId !== 'mailbox'">
            <NotificationList
                class="o_Discuss_notificationList"
                filter="discuss.activeMobileNavbarTabId"
            />
        </t>
        <t t-if="env.messaging.device.isMobile and !discuss.isReplyingToMessage">
            <MobileMessagingNavbar
                class="o_Discuss_mobileNavbar"
                activeTabId="discuss.activeMobileNavbarTabId"
                tabs="mobileNavbarTabs()"
                t-on-o-select-mobile-messaging-navbar-tab="_onSelectMobileNavbarTab"
            />
        </t>
        <t t-if="discuss.isReplyingToMessage">
            <Composer
                class="o_Discuss_replyingToMessageComposer"
                composerLocalId="discuss.replyingToMessage.originThread.composer.localId"
                hasCurrentPartnerAvatar="!env.messaging.device.isMobile"
                hasDiscardButton="true"
                hasThreadName="true"
                isDoFocus="discuss.isDoFocus"
                textInputSendShortcuts="['ctrl-enter', 'meta-enter']"
                t-on-o-focusin-composer="_onFocusinComposer"
                t-on-o-message-posted="_onReplyingToMessageMessagePosted"
                t-ref="composer"
            />
        </t>
    </t>

</templates>
