<?xml version="1.0" encoding="utf-8"?>
<odoo>
<data>
    <!-- Article Tree layout -->
    <template id="knowledge_article_tree_template" name="Article Tree">
        <t t-call="knowledge.article_favourite_section_template"/>

        <section class="o_section" data-section="workspace">
            <div class="o_section_header d-flex h4 mb-0">
                <div class="flex-grow-1 text-truncate">Workspace</div>
                <button class="o_section_create btn btn-link text-secondary rounded p-0" type="button">
                    <i class="fa fa-fw fa-plus"/>
                </button>
            </div>
            <ul class="o_tree">
                <t t-call="knowledge.articles_template">
                    <t t-set="articles" t-value="public_articles"/>
                </t>
            </ul>
        </section>

        <section t-if="shared_articles" class="o_section mb-3" data-section="shared">
            <div class="o_section_header d-flex h4 mb-0">
                <div class="flex-grow-1 text-truncate">Shared</div>
            </div>
            <ul class="o_tree">
                <t t-call="knowledge.articles_template">
                    <t t-set="articles" t-value="shared_articles"/>
                </t>
            </ul>
        </section>

        <section class="o_section mb-3" data-section="private">
            <div class="o_section_header d-flex h4 mb-0">
                <div class="flex-grow-1 text-truncate">Private</div>
                <button class="o_section_create btn btn-link text-secondary rounded p-0" type="button">
                    <i class="fa fa-fw fa-plus"/>
                </button>
            </div>
            <ul class="o_tree">
                <t t-call="knowledge.articles_template">
                    <t t-set="articles" t-value="private_articles"/>
                </t>
            </ul>
        </section>
    </template>

    <template id="article_favourite_section_template">
        <section class="o_favourite_container" t-if="favourites">
            <div class="h4 mb-0">Favourites</div>
            <ul class="o_tree_favourite">
                <t t-call="knowledge.articles_template">
                    <t t-set="articles" t-value="favourites.mapped('article_id')"/>
                    <t t-set="hideChildren" t-value="true"/>
                </t>
            </ul>
        </section>
        <section class="o_favourite_container" t-else=""/>
    </template>

    <template id="articles_template">
        <t t-set="unfolded_articles" t-value="unfolded_articles or []"/>
        <t t-foreach="articles" t-as="article">
            <t t-set="readonly" t-value="not article.user_can_write"/>
            <t t-set="favourite" t-value="favourites.filtered(lambda f: f.article_id == article) if favourites else False"/>
            <t t-set="favourite_sequence" t-value="favourite.sequence if favourite else False"/>
            <li t-attf-class="o_article #{ 'readonly' if readonly else '' }" t-attf-id="article_#{article.id}"
                t-att-data-article-id="article.id"  t-att-data-category="article.category"
                t-att-data-favourite-sequence="favourite_sequence">
                <t t-set="isActive" t-value="article.id == active_article_id"/>
                <div t-attf-class="o_article d-flex #{ 'o_article_active font-weight-bold' if isActive else 'text-muted' }">
                    <button t-if="not hideChildren and article.child_ids" class="o_article_caret btn btn-link text-muted p-0" type="button">
                        <i t-if="article.child_ids" t-att-class="'align-self-center fa fa-fw fa-caret-' + ('down' if article.id in unfolded_articles else 'right')"/>
                        <i t-else="" class="pl-3 align-self-center"/>
                    </button>
                    <div class="dropdown">
                        <a t-attf-class="o_article_icon p-1 {{'o_article_icon_active text-900' if isActive else ''}}" type="button"
                           t-attf-id="o_article_dropdown_#{article.id}" data-toggle="dropdown" aria-expanded="true">
                            <i t-attf-class="fa fa-fw #{article.icon}"/>
                        </a>
                        <div class="o_article_dropdown dropdown-menu p-0" role="menu" t-attf-aria-labelledby="o_article_dropdown_#{article.id}">
                            <i class="fa fa-fw fa-file" data-icon-name="fa-file"/>
                            <i class="fa fa-fw fa-book" data-icon-name="fa-book"/>
                            <i class="fa fa-fw fa-user" data-icon-name="fa-user"/>
                            <i class="fa fa-fw fa-address-book" data-icon-name="fa-address-book"/>
                            <i class="fa fa-fw fa-calendar" data-icon-name="fa-calendar"/>
                            <i class="fa fa-fw fa-code" data-icon-name="fa-code"/>
                            <i class="fa fa-fw fa-car" data-icon-name="fa-car"/>
                            <i class="fa fa-fw fa-comment" data-icon-name="fa-comment"/>
                            <i class="fa fa-fw fa-bullhorn" data-icon-name="fa-bullhorn"/>
                        </div>
                    </div>
                    <div class="o_article_name flex-grow-1 text-truncate o_cursor_pointer">
                        <t t-out="article.name"/>
                    </div>
                    <button t-if="not hideChildren" class="o_article_create btn p-0 opacity-75 opacity-100-hover" type="button">
                        <i class="fa fa-fw fa-plus"/>
                    </button>
                </div>
                <ul t-if="not hideChildren and article.child_ids and article.id in unfolded_articles">
                    <t t-call="knowledge.articles_template">
                        <t t-set="articles" t-value="article.child_ids.sorted('sequence').filtered(lambda child: child.user_has_access)"/>
                    </t>
                </ul>
            </li>
        </t>
    </template>
</data>
</odoo>
