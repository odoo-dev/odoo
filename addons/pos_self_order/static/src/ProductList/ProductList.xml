<?xml version="1.0" encoding="UTF-8"?>
<templates id="template" xml:space="preserve">
    <t t-name="ProductList" owl="1">
        <div class="sticky-top">
            <NavBar previousPage="''" />
<!-- tag and search bar -->
            <div class="d-flex justify-content-center align-items-center p-0 m-0 bg-100 shadow-sm">
                <div class="h-100 p-3">
    <!-- search input -->
                    <t t-if="private_state.search_is_focused">
                        <div class="w-100 d-flex align-items-center">
                            <div class="input-group">
                                <input type="text" class="form-control " t-ref="searchInput" placeholder="Pizza"
                                        t-model="private_state.search_input"/>
                                <button class="btn btn-outline-primary"
                                        t-on-click="() => closeSearch()">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" 
                                        fill="currentColor" class="bi bi-x" viewBox="0 0 16 16">
                                        <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </t>
                    <t t-else="">
                    <!-- TODO: this focusearch() only gets called when you click on the very small svg icon
                    we have to make it so it's called when you click on the div that holds it -->
<i class="fa-solid fa-magnifying-glass"></i>
                        <!-- <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" 
                            fill="currentColor" class="bi bi-search" viewBox="0 0 16 16"
                            t-on-click="() => focusSearch()">
                            <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                        </svg> -->
                    </t>
                </div>
    <!-- tag select -->
                <t t-if="!private_state.search_is_focused">
                    <div class="p-3 overflow-auto text-nowrap border-start">
                        <t t-foreach="Array.from(selfOrder.config.tagList)" t-as="tag" t-key="tag">
                            <div class="mx-1 d-inline float-none"
                                t-on-click="() => selectTag(tag)">
                                <span t-attf-class="badge px-2 py-2 rounded {{private_state.selected_tags.has(tag) ? 'text-bg-primary' : 'text-bg-light'}}">
                                    <t t-esc="tag"/>
                                </span>
                            </div>
                        </t>
                    </div>
                </t>
            </div>
        </div>



            <div class="bg-300 p-2">
                <t t-if="filteredProducts().length > 0">
                    <t t-set="tag" t-value="filteredProducts()[0].tagList"/>
                    <t t-esc="Array.from(tag).join(' ')"/>
                </t>
                <t t-else="">
                    <p class="text-center">
                        No products found
                    </p>
                </t>
                <t t-foreach="filteredProducts()" t-as="product" t-key="product.product_id">
                    <t t-if="!areSetsEqual(product.tagList, tag)">
                        <t t-set="tag" t-value="product.tagList"/>
                        <t t-esc="Array.from(tag).join(' ')"/>
                    </t>
                    <div class="o_self_order_item_card d-flex flex-row card my-2 rounded shadow-sm overflow-hidden" t-on-click="() => env.navigate('products/' + product.product_id)" t-ref="{{product.product_id}}">
                        <div class="o_self_order_item_card--image">
                            <img class="h-100 w-100" t-attf-src="/pos-self-order/get-images/{{ product.product_id }}" alt="Product image"/>
                        </div>
                        <div class="o_self_order_item_card--content d-flex flex-column p-2">
                            <t t-if="product.description_sale != false">
                                <h5 class="mb-0 text-900 ">
                                    <t t-esc="product.name"/>
                                </h5>
                                <p class="flex-grow-1 mb-1 text-muted small lh-sm break-line">
                                    <t t-esc="product.description_sale" />
                                </p>
                            </t>
                            <t t-else="">
                                <h5 class="flex-grow-1 mb-0 text-900">
                                    <t t-esc="product.name"/>
                                </h5>
                            </t>
                            <p class="card-text text-primary fw-bold">
                                <t t-esc="formatMonetary(product.list_price, {currencyId: selfOrder.config.currency_id})" />
                            </p>
                        </div>
                    </div>
                </t>
            </div>
    </t>
</templates>

