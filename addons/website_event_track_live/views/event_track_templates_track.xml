<?xml version="1.0" encoding="utf-8"?>
<odoo>

<template id="event_track_main" inherit_id="website_event_track_session.event_track_main">
    <xpath expr="//div[hasclass('o_wesession_track_container')]" position="attributes">
        <attribute name="t-attf-class">o_wesession_track_container px-4 py-3</attribute>
    </xpath>
</template>

<template id="event_track_main_display" inherit_id="website_event_track_session.event_track_main_display">
    <xpath expr="//ul[hasclass('o_wesession_track_aside_nav')]" position="inside">
        <li t-if="track.youtube_video_url and (track.is_track_upcoming or track.is_track_live)" class="nav-item flex-grow-1">
            <a href="#track_chat" aria-controls="track_chat" class="nav-link" role="tab" data-toggle="tab">
                Chat
            </a>
        </li>
    </xpath>
    <xpath expr="//div[hasclass('o_wesession_track_aside_tabs')]" position="inside">
        <div t-if="track.youtube_video_url and (track.is_track_upcoming or track.is_track_live)" id="track_chat"
            class="tab-pane fade o_wesession_track_aside_tab_chat" role="tabpanel">
            <iframe t-attf-src="https://www.youtube.com/live_chat?v=#{track.youtube_video_id}&amp;embed_domain=#{hostname}"
                height="100%"
                width="100%"
                frameborder="0" allowfullscreen="allowfullscreen"/>
        </div>
    </xpath>
    <xpath expr="//div[hasclass('o_wesession_track_aside_tabs')]//div[hasclass('tab-pane')]" position="before">
        <t t-set="viewers_count" t-value="tracks_other._get_viewers_count()"/>
    </xpath>
    <xpath expr="//div[hasclass('o_wesession_track_aside_info')]//small" position="before">
        <small t-if="int(viewers_count.get(track_other.id, {}).get('live_views', 0)) > 0" class="text-muted mr-2">
            <span t-esc="viewers_count.get(track_other.id).get('live_views')"/><span> watching</span>
        </small>
        <small t-elif="int(viewers_count.get(track_other.id, {}).get('total_views', 0)) > 0" class="text-muted mr-2">
            <span t-esc="viewers_count.get(track_other.id).get('total_views')"/><span> views</span>
        </small>
    </xpath>
    <xpath expr="//div[hasclass('o_wesession_track_main_content')]" position="replace">
        <t t-set="live_video" t-value="track.youtube_video_url and (track.is_track_upcoming or track.is_track_live)"/>
        <div t-attf-class="row bg-white ml-3 o_wesession_track_main_content #{'pt-3' if not live_video else ''}">
            <t t-if="live_video">
                <div class="flex-grow-1 o_wevent_event_track_live"
                    t-att-data-track-id="track.id"
                    t-att-data-youtube-video-id="track.youtube_video_id">
                    <div id="o_wevent_youtube_iframe_container" class="w-100"/>
                </div>
            </t>
            <t t-else="" t-call="website_event_track_session.event_track_description"/>
        </div>
    </xpath>
</template>

<template id="track_card" inherit_id="website_event_track_session.track_card">
    <xpath expr="//article//footer" position="inside">
        <div t-if="int(viewers_count.get(track.id, {}).get('live_views', 0)) > 0" class="text-muted text-right mt-1">
            <span t-esc="viewers_count.get(track.id).get('live_views')"/><span> watching</span>
        </div>
        <div t-elif="int(viewers_count.get(track.id, {}).get('total_views', 0)) > 0" class="text-muted text-right mt-1">
            <span t-esc="viewers_count.get(track.id).get('total_views')"/><span> views</span>
        </div>
    </xpath>
</template>

<template id="tracks_display_list" inherit_id="website_event_track_session.tracks_display_list">
    <xpath expr="//span[@name='o_wesession_tracks_list_topic_label']" position="attributes">
        <attribute name="class">col-md-3 o_wesession_tracks_list_topic_label</attribute>
    </xpath>
    <xpath expr="//a[@name='o_wesession_tracks_list_topic_value']" position="attributes">
        <attribute name="class">col-md-3 o_wesession_tracks_list_topic_value</attribute>
    </xpath>
    <xpath expr="//span[@name='o_wesession_tracks_list_partner_label']" position="after">
        <span class="col-md-1">Viewers</span>
    </xpath>
    <xpath expr="//span[@name='o_wesession_tracks_list_partner_value']" position="after">
        <span t-if="int(viewers_count.get(track.id, {}).get('live_views', 0)) > 0"
            class="text-muted col-md-1" t-esc="viewers_count.get(track.id).get('live_views')"/>
        <span t-elif="int(viewers_count.get(track.id, {}).get('total_views', 0)) > 0"
            class="text-muted col-md-1" t-esc="viewers_count.get(track.id).get('total_views')"/>
        <span t-else="" class="col-md-1"/>
    </xpath>
</template>

</odoo>
