<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <template id="cart_delivery" name="Delivery Costs" inherit_id="website_sale.total">
        <tr id="order_total_untaxed" position="before">
            <tr id="order_delivery" t-if="website_sale_order and website_sale_order.carrier_id">
                <td colspan="2" class="ps-0 pt-0 pb-2 border-0 text-muted"
                    title="Delivery will be updated after choosing a new delivery method">
                    Delivery
                </td>
                <td class="text-end pe-0 pt-0 pb-2 border-0 text-muted">
                    <span t-field="website_sale_order.amount_delivery"
                          class="monetary_field"
                          style="white-space: nowrap;"
                          t-options='{"widget": "monetary", "display_currency": website_sale_order.currency_id}'/>
                </td>
            </tr>
        </tr>
    </template>

    <template id="website_sale.payment_delivery" name="Delivery Costs" inherit_id="website_sale.payment">
        <!-- TODO VCR: Factorize that in checkout_templates -->
        <xpath expr="//div[@name='website_sale_non_free_cart']" position="before">
            <div t-if="deliveries" id="delivery_carrier">
                <h4>Choose a delivery method</h4>
                <div class="card border-0" id="o_delivery_form">
                    <ul class="list-group">
                        <t t-foreach="deliveries" t-as="delivery">
                            <li class="list-group-item o_delivery_carrier_select">
                                <t t-call="website_sale.payment_delivery_methods">
                                    <t t-set="is_selected"
                                       t-value="order.carrier_id == delivery"
                                    />
                                </t>
                            </li>
                        </t>
                    </ul>
                </div>
            </div>
        </xpath>
    </template>

    <template id="website_sale.payment_delivery_methods">
        <!-- Parameters description:
            - delivery: The delivery carrier to display, as a sudoed `delivery.carrier` recordset.
            - is_selected: Whether the radio button of the delivery carrier should be checked.
        -->
        <!-- === Radio button === -->
        <input
            t-attf-id="o_delivery_carrier_{{delivery.id}}"
            name="o_delivery_carrier"
            type="radio"
            t-att-checked="is_selected"
            class="pe-none"
            t-att-value="delivery.id"
            t-att-data-delivery-type="delivery.delivery_type"
        />
        <label class="label-optional" t-out="delivery.name"/>
        <span class="o_wsale_delivery_badge_price float-end fw-bold" name="price">
            Select to compute delivery rate
        </span>
        <div>
            <div class="d-none">
                <span class="o_order_location">
                    <b class="o_order_location_name"/>
                    <br/>
                    <i class="o_order_location_address"/>
                </span>
                <span
                    name="o_delivery_location_selector_edit"
                    class="fa fa-pencil ms-2"
                    aria-label="Change location"
                    title="Change location"
                    t-att-data-carrier-id="delivery.id"
                />
            </div>
            <t t-set='delivery_method' t-value="delivery.delivery_type+'_use_locations'" />
            <t t-if="delivery_method in delivery.fields_get() and delivery[delivery_method]">
                <button
                    name="o_delivery_location_selector"
                    type="button"
                    class="btn btn-primary btn-sm"
                    t-att-data-carrier-id="delivery.id"
                    t-att-data-zip-code="order.partner_shipping_id.zip"
                    t-att-data-partner-latitude="order.partner_shipping_id.partner_latitude"
                    t-att-data-partner-longitude="order.partner_shipping_id.partner_longitude"
                >
                    Select a location
                </button>
            </t>
        </div>
        <t t-if="delivery.website_description">
            <div t-field="delivery.website_description" class="text-muted mt8"/>
        </t>
    </template>

</odoo>
