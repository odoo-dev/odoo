<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">

    <t t-name="web.KanbanRenderer" owl="1">
        <div class="o_kanban_view" t-attf-class="o_kanban_{{ props.list.isGrouped ? '' : 'un' }}grouped {{ props.info.className or '' }}">
            <t t-foreach="getGroupsOrRecords()" t-as="groupOrRecord" t-key="groupOrRecord.id">
                <t t-if="props.list.isGrouped">
                    <t t-set="group" t-value="groupOrRecord" />
                    <div class="o_kanban_group"
                        t-att-class="getGroupClasses(group)"
                        t-on-mouseenter="() => state.hoveredColumn = group.id"
                        t-on-mouseleave="() => state.hoveredColumn = null"
                        t-on-click="onGroupClick(group)"
                    >
                        <div class="o_kanban_header">
                            <div class="o_kanban_header_title">
                                <span class="o_column_title" t-esc="getGroupName(group)" />
                                <t t-if="group.isLoaded">
                                    <Dropdown t-if="state.hoveredColumn === group.id" class="o_kanban_config" togglerClass="'btn p-0'">
                                        <t t-set-slot="toggler">
                                            <i class="fa fa-gear" role="img" aria-label="Settings" title="Settings" />
                                        </t>
                                        <ul class="list-unstyled m-0">
                                            <button role="menuitem"
                                                class="dropdown-item o_kanban_toggle_fold"
                                                t-on-click="toggleGroup(group)"
                                            >
                                                Fold
                                            </button>
                                            <button t-if="canEditGroup(group)"
                                                role="menuitem"
                                                class="dropdown-item o_column_edit"
                                                t-on-click="editGroup(group)"
                                            >
                                                Edit Stage
                                            </button>
                                            <button t-if="canDeleteGroup(group)"
                                                role="menuitem"
                                                class="dropdown-item o_column_delete"
                                                t-on-click="deleteGroup(group)"
                                            >
                                                Delete
                                            </button>
                                            <t t-if="canArchiveGroup(group)">
                                                <button role="menuitem"
                                                    class="dropdown-item o_column_archive_records"
                                                    t-on-click="archiveGroup(group)"
                                                >
                                                    Archive All
                                                </button>
                                                <button role="menuitem"
                                                    class="dropdown-item o_column_unarchive_records"
                                                    t-on-click="unarchiveGroup(group)"
                                                >
                                                    Unarchive All
                                                </button>
                                            </t>
                                        </ul>
                                    </Dropdown>
                                    <span t-if="props.info.quickCreate" class="o_kanban_quick_add" t-on-click="quickCreate(group)">
                                        <i class="fa fa-plus" role="img" aria-label="Quick add" title="Quick add" />
                                    </span>
                                </t>
                                <span t-else="" class="o_column_unfold">
                                    <i class="fa fa-arrows-h" role="img" aria-label="Unfold" title="Unfold" />
                                </span>
                            </div>
                            <div t-if="group.isLoaded and group.progress" class="o_kanban_counter">
                                <div class="o_kanban_counter_progress progress">
                                    <t t-foreach="group.progress" t-as="progressData" t-key="progressData.color">
                                        <div t-if="progressData.count"
                                            role="progressbar"
                                            class="progress-bar o_bar_has_records"
                                            t-att-class="{ 'progress-bar-animated progress-bar-striped': group.activeProgressValue === progressData.value }"
                                            t-attf-class="bg-{{ progressData.color }}"
                                            t-attf-style="width: {{ progressData.count / progressData.total * 100 }}%;"
                                            aria-valuemin="0"
                                            t-att-aria-valuemax="progressData.total"
                                            t-att-aria-valuenow="progressData.count"
                                            t-attf-data-tooltip="{{ progressData.count }} {{ progressData.string }}"
                                            data-tooltip-delay="0"
                                            t-on-click="props.list.model.filterProgressValue(group, progressData.value)"
                                        />
                                    </t>
                                </div>
                                <t t-set="sumField" t-value="getProgressSumField(group)" />
                                <div class="o_kanban_counter_side" t-att-title="sumField.string">
                                    <b t-esc="sumField.value" />
                                </div>
                            </div>
                        </div>
                        <t t-if="group.isLoaded">
                            <t t-if="state.quickCreate[group.id]">
                                <View resModel="props.list.resModel" type="'form'" display="{ controlPanel: false }" />
                            </t>
                            <t t-foreach="group.data" t-as="record" t-key="record.id">
                                <t t-call="{{ cardTemplate }}" />
                            </t>
                            <t t-set="unloadedCount" t-value="getGroupUnloadedCount(group)" />
                            <div t-if="unloadedCount" class="o_kanban_load_more">
                                <a href="#" t-on-click="loadMore(group)">
                                    Load more... (<t t-esc="unloadedCount" /> remaining)
                                </a>
                            </div>
                        </t>
                    </div>
                </t>
                <t t-else="">
                    <t t-call="{{ cardTemplate }}">
                        <t t-set="record" t-value="groupOrRecord" />
                    </t>
                </t>
            </t>
            <t t-if="props.list.isGrouped">
                <div t-if="canCreateGroup()" class="o_column_quick_create">
                    <div t-if="state.quickCreateGroup" class="o_quick_create_unfolded">
                        <div class="o_kanban_header">
                            <div class="input-group">
                                <input type="text"
                                    class="form-control o_input"
                                    placeholder="Column title"
                                    autofocus=""
                                    t-on-focus="() => state.quickCreateGroupInputFocus = true"
                                    t-on-blur="() => state.quickCreateGroupInputFocus = false"
                                />
                                <span class="input-group-append">
                                    <button class="btn btn-primary o_kanban_add" type="button">Add</button>
                                </span>
                            </div>
                            <span t-if="state.quickCreateGroupInputFocus" class="o_discard_msg text-muted float-right">
                                Esc to discard
                            </span>
                        </div>
                        <div t-foreach="[,,,]" t-as="i" t-key="i_index" class="o_kanban_muted_record" />
                    </div>
                    <div t-else="" class="o_quick_create_folded" t-on-click="() => state.quickCreateGroup = true">
                        <span class="o_kanban_add_column">
                            <i class="fa fa-plus" role="img" aria-label="Add column" title="Add column" />
                        </span>
                        <span class="o_kanban_title">Add a Column</span>
                    </div>
                </div>
            </t>
            <t t-else="">
                <!-- kanban ghost cards are used to properly space last elements. -->
                <div t-foreach="[,,,,,,]" t-as="i" t-key="i_index" class="o_kanban_record o_kanban_ghost" />
            </t>
        </div>
    </t>

    <t t-name="web.KanbanColorPicker" owl="1">
        <ul class="oe_kanban_colorpicker">
            <t t-foreach="colors" t-as="color" t-key="color">
                <li role="menuitem" t-on-click="selectColor(record, color_index)" t-att-title="color" t-att-aria-label="color">
                    <a href="#" t-attf-class="oe_kanban_color_{{ color_index }}" />
                </li>
            </t>
        </ul>
    </t>

</templates>
