<?xml version="1.0" encoding="utf-8"?>
<odoo>

<template id="event_meet" name="Meeting Rooms">
    <t t-call="website_event.layout">
        <div class="o_wevent_online o_wevent_online_bg o_wemeet_index">
            <!-- Drag/Drop Area -->
            <div id="oe_structure_website_event_location_1" class="oe_structure"/>
            <!-- Content -->
            <div class="o_wemeet_container container">
                <div class="row pt-3">
                    <t t-call="website_event_meet.meet_main"/>
                </div>
            </div>
            <!-- Drag/Drop Area -->
            <div id="oe_structure_website_event_location_2" class="oe_structure"/>
        </div>
    </t>
</template>

<!-- ============================================================ -->
<!-- CONTENT: MAIN TEMPLATES -->
<!-- ============================================================ -->

<!-- Exhibitors Main Display -->
<template id="meet_main" name="Exhibitors: Main Display">
    <div class="mw-75 col-12 col-md-8">
        <h1 class="o_page_header mb-3 d-flex flex-row justify-content-between">
            <span>Join a room</span>
            <div class="o_dropdown_kanban dropdown">
                <a aria-label="Dropdown menu" class="dropdown-toggle o-no-caret btn" data-display="static" data-toggle="dropdown" href="#" role="button" title="Dropdown menu">
                    <span t-esc="current_lang.name if current_lang else 'All Languages'"/> â–¼</a>
                <div class="dropdown-menu" role="menu">
                    <a class="dropdown-item" role="menuitem" t-attf-href="/event/#{slug(event)}/meeting_rooms">All Languages
                       </a>
                    <a class="dropdown-item" role="menuitem" t-as="language" t-attf-href="/event/#{slug(event)}/meeting_rooms?lang=#{language.id}" t-esc="language.name" t-foreach="available_languages"/>
                </div>
            </div>
        </h1>
        <p>Choose a topic that interests you and start talking with the community.</p>
        <p>Don't forget to setup your camera and microphone.</p>
        <div class="d-flex flex-column justify-content-start align-items-start">
            <t t-as="meeting_room" t-call="website_event_meet.meeting_room_card" t-foreach="meeting_rooms">
                <t t-set="meeting_room" t-value="meeting_room"/>
                <t t-set="opened" t-value="int(meeting_room.id == open_room_id)"/>
            </t>
        </div>
    </div>
    <div class="w-25 d-none d-md-block col-md-4">
        <h1 class="o_page_header mb-3">Launch a new topic</h1>
        <p>Want to create your own discussion room ?</p>
        <p>Be sure you are ready to spend at least 10 minutes in the room if you want to initiate a new topic.</p>
        <button class="btn btn-primary o_wevent_create_room_button" t-att-data-event="event.id" t-att-data-default-lang="default_lang_code">Create a Room</button>
    </div>
</template>

<template id="meeting_room_card" name="Meeting Room Card">
    <div class="modal o_join_later_modal" tabindex="-1" role="dialog" style="height: 400px; top:calc(50% - 200px);">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="mt-4 col-12 alert alert-warning text-center" role="alert">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">&amp;times;</button>
                    <span>This room is not open right now!</span><br />
                    Join us here on the
                    <strong itemprop="startDate" t-field="event.with_context(tz=event.date_tz).date_begin" t-options="{'format': 'medium'}"/>
                    to have a chat with us!
                </div>

                <div class="modal-body row">
                    <div class="col-3">
                        <div class="w-100" t-attf-style="background-image: #{json.loads(event.cover_properties).get('background-image')}; min-height: 5rem; background-size: cover;"/>
                    </div>
                    <div class="col">
                        <h5 t-esc="meeting_room.name"/>
                        <div class="text-muted mb-2"><i class="fa fa-globe"/> <span t-esc="meeting_room.room_lang_id.name"/></div>
                        <span t-if="meeting_room.summary" t-raw="meeting_room.summary"/>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div t-if="is_event_manager or not meeting_room.room_is_full" t-att-data-meeting-room-id="meeting_room.id" t-att-data-open-room="opened" t-att-data-is-event-manager="int(is_event_manager)" t-attf-class="card o_wevent_meeting_room_card w-100 m-2 bg-light">
        <div class="text-decoration-none w-100 h-100 p-4">
            <div class="o_wevent_meeting_room_corner_ribbon" t-if="meeting_room.room_is_full">Full</div>
            <button t-if="is_event_manager and meeting_room.room_is_full" class="btn btn-danger float-right o_wevent_meeting_room_duplicate ml-1" type="button">Duplicate</button>
            <button t-if="is_event_manager" class="btn btn-danger float-right o_wevent_meeting_room_delete" type="button">Close</button>
            <h3><t t-esc="meeting_room.name"/> <t t-if="is_event_manager and meeting_room.is_pinned" t-esc="'(pinned)'"/></h3>
            <h5 t-esc="meeting_room.summary"/>
            <h4 class="m-0 row text-primary">
                <b>&amp;#9900;&amp;nbsp;</b>
                <span class="o_wevent_participant_count">
                    <t t-esc="meeting_room.room_participant_count"/>&amp;nbsp;</span>
                <t t-esc="meeting_room.target_audience or 'participant(s)'"/>
            </h4>
            <div class="d-flex flex-row justify-content-between mt-3">
                <!--During the event or if event manager-->
                <a t-if="event.is_ongoing or is_event_manager"
                    t-att-title="'Join %s' % meeting_room.name"
                    t-attf-href="/event/#{ slug(event) }/meeting_room/#{ slug(meeting_room) }"
                    class="btn btn-primary">Join the room</a>
                <!--Pre-event, if not registered yet-->
                <a t-elif="not event.is_ongoing and not event.is_participating"
                    t-attf-href="/event/#{ slug(event) }/register"
                    class="btn btn-primary">Join the room</a>
                <!--Pre-event, if registered but event not stared yet-->
                <a t-else="not event.is_ongoing" href="#" data-toggle="modal" data-target=".o_join_later_modal"
                    class="btn btn-primary">Join the room</a>

                    <!--<button t-else="not event.is_ongoing"-->
                       <!--class="btn btn-primary o_wemeet_join_later">Join the room</button>-->
                <div class="d-inline border p-2 bg-secondary" t-esc="meeting_room.room_lang_id.name"/>
            </div>
        </div>
    </div>
</template>

</odoo>
